{% load i18n %}
{% load static %}
{% load flatpages %}

<nav class="navbar navbar-default">
    <div class="container">
        <header class="navbar-header">
              <button type="button" class="navbar-toggle collapsed toggle-menu menu-right">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <h1 class="site-logo"><a href="/"><span class="sr-only">Bike Anjo</span></a></h1>
        </header>
        <script>
        window.onload = function() {
            $('button.toggle-menu').jPushMenu({
                menuOpenClass      : 'cbp-spmenu-open',
                closeOnClickOutside: true,
                closeOnClickLink   : false
            });
        };
        </script>
        <nav id="navbar" class="navbar-collapse cbp-spmenu cbp-spmenu-vertical cbp-spmenu-right">
            <div class="navigation">
                {% if user.is_authenticated %}
                <ul class="user-menu nav nav-pills">
                    <li role="presentation" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                        <span class="user-icon">

                            {% if user.role == 'bikeanjo' %}
                                {% if user.helpbikeanjo_set.unread.exists %}
                                <span class="alert bubble">{{ user.helpbikeanjo_set.unread.count }}</span>
                                {% endif %}
                            {% endif %}
                            {% if user.role == 'requester' %}
                                {% if user.helprequested_set.unread.exists %}
                                <span class="alert bubble">{{ user.helprequested_set.unread.count }}</span>
                                {% endif %}
                            {% endif %}

                            <img src="{{ user.get_avatar_url }}"
                                 width="45" height="45" 
                                 title="{{ user.get_full_name }}"
                                 onerror="this.src='{% static "imgs/empty-avatar.png" %}'"
                                 alt="{% trans "Photo from" %} {{ user.get_full_name }}"/>
                        </span>
                        {% firstof user.first_name user.username %}
                        <i class="fa fa-angle-down"></i></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="{% url 'cyclist_dashboard' %}">{% trans "Panel" %}</a></li>
                            <li><a href="{% url 'cyclist_my_requests' %}">{% trans "Help requests" %}</a></li>
                            <li><a href="{% url 'dashboard_message_list' %}">{% trans "Messages" %}</a></li>
                            <li><a href="{% url 'user_register' %}">{% trans "Edit profile" %}</a></li>
                            <li><a href="{% url 'account_logout' %}">{% trans "Logout" %}</a></li>
                            {% if user.role == 'requester' %}
                            <li class="btn btn-default"><a href="{% url 'requester_help_request' %}">{% trans "I want help to ride" %}</a></li>
                            {% endif %}
                        </ul>
                    </li>
                </ul>
                {% endif %}
                <ul class="nav nav-pills">
                    
                    {% get_flatpages '/about/' as about_pages %}
                    {% if about_pages %}
                    <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">Quem somos
                        <i class="fa fa-angle-down"></i></a>
                        <ul class="dropdown-menu" role="menu">
                            {% for page in about_pages %}
                                <li><a href="{{page.url}}">{{page.title}}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% endif %}
                    
                    {% get_flatpages '/work/' as work_pages %}
                    {% if work_pages %}
                    <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">O que fazemos
                        <i class="fa fa-angle-down"></i></a>
                        <ul class="dropdown-menu" role="menu">
                            {% for page in work_pages %}
                                <li><a href="{{page.url}}">{{page.title}}</a></li>
                            {% endfor %}
                            <li><a href="{% url 'dashboard_event_list' %}">Eventos</a></li>
                            <li><a href="#">Dicas para quem quer pedalar</a></li>
                        </ul>
                    </li>
                    {% endif %}

                    {% get_flatpages '/support/' as support_pages %}
                    {% if support_pages %}
                    <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">Ap√≥ie
                        <i class="fa fa-angle-down"></i></a>
                        <ul class="dropdown-menu" role="menu">
                            {% for page in support_pages %}
                                <li><a href="{{page.url}}">{{page.title}}</a></li>
                            {% endfor %}
                        </ul>
                    </li>
                    {% endif %}

                    <li role="presentation" class="dropdown">
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-expanded="false">Contato
                        <i class="fa fa-angle-down"></i></a>
                        <ul class="dropdown-menu" role="menu">
                            <li><a href="{% url 'contact_view' %}">Contato</a></li>
                        </ul>
                    </li>
                    <li>
                        <a href="http://bikeanjo.org/blog/" target="_blank">Blog</a>
                    </li>
                </ul>
                <div class="divider"></div>
                {% if not user.is_authenticated %}
                <a href="{% url 'account_login' %}" class="btn btn-primary">{% trans "Sign in" %}</a>
                {% endif %}
            </div>
        </nav><!--/.navbar-collapse -->
    </div>
</nav>
